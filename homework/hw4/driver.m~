%% The one script to rule them all

clear
close all

%% Reconstruction

fnames = dir('*STD.mat');
ims = {};
ims_rms = {};
plot = false;

i = 1; 
load(fnames(i).name)
if i <= 3
    first = true;
else
    first = false;
end
[ims{i}, ims_rms{i}] = Reconstruct(fdata, plot, first);

figure(1)
imagesc(log(ims_rms{i})); colormap(gray)
fg = roipoly();
bg = roipoly();

imagesc(fg+bg);
sloc = find(fg == 1);
nloc = find(bg == 1);

sig{i} = ims_rms{i}(sloc);
noi{i} = ims_rms{i}(nloc);

SNR{i} = sig{i}/noi{i};

% panel plot
% title is the scan; and snr